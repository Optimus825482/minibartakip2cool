{% extends "base.html" %} {% block title %}Minibar Kontrol - Setup Bazlƒ±{%
endblock %} {% block page_title %}Minibar Kontrol{% endblock %} {% block content
%}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
  <!-- Oda Se√ßimi Section -->
  <div
    id="oda_secimi_section"
    class="bg-white rounded-lg shadow-sm border border-slate-200 mb-6"
  >
    <div class="p-6">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-lg font-semibold text-slate-900">Oda Se√ßimi</h3>
        <button
          onclick="qrIleBaslat()"
          class="inline-flex items-center px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition-colors"
        >
          <svg
            class="h-5 w-5 mr-2"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"
            ></path>
          </svg>
          QR Kod ƒ∞le
        </button>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label
            for="kat_id"
            class="block text-sm font-medium text-slate-700 mb-2"
          >
            Kat <span class="text-red-500">*</span>
          </label>
          <select
            id="kat_id"
            required
            class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-slate-500 focus:border-slate-500"
          >
            <option value="">Kat se√ßiniz...</option>
            {% for kat in katlar %}
            <option value="{{ kat.id }}">{{ kat.kat_adi }}</option>
            {% endfor %}
          </select>
        </div>

        <div>
          <label
            for="oda_id"
            class="block text-sm font-medium text-slate-700 mb-2"
          >
            Oda <span class="text-red-500">*</span>
          </label>
          <select
            id="oda_id"
            required
            disabled
            class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-slate-500 focus:border-slate-500 disabled:bg-slate-100 disabled:cursor-not-allowed"
          >
            <option value="">√ñnce kat se√ßiniz...</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Oda Detaylarƒ± ve Setup Section (Ba≈ülangƒ±√ßta Gizli) -->
  <div id="oda_detaylari_section" class="hidden">
    <!-- Oda Bilgileri Header -->
    <div
      class="bg-gradient-to-r from-slate-700 to-slate-800 rounded-lg shadow-lg mb-6 p-6 text-white border border-slate-600"
    >
      <div class="flex items-center justify-between">
        <div class="flex-1">
          <h2 class="text-2xl font-bold mb-2">
            Oda: <span id="oda_no_display">-</span>
          </h2>
          <p class="text-slate-300">
            Oda Tipi:
            <span id="oda_tipi_display" class="font-semibold text-white"
              >-</span
            >
          </p>
        </div>
        <div class="text-right">
          <div
            class="bg-slate-600/50 backdrop-blur-sm rounded-lg px-6 py-4 border border-slate-500"
          >
            <p class="text-sm text-slate-300 mb-1">Toplam Setup</p>
            <p class="text-4xl font-bold" id="toplam_setup_display">0</p>
          </div>
        </div>
      </div>
      <button
        onclick="geriDon()"
        class="mt-4 inline-flex items-center px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-500 transition-colors"
      >
        <svg
          class="h-5 w-5 mr-2"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M10 19l-7-7m0 0l7-7m-7 7h18"
          ></path>
        </svg>
        Geri D√∂n
      </button>
    </div>

    <!-- Setup Accordion Container -->
    <div id="setup_accordion_container" class="space-y-4">
      <!-- Dinamik olarak doldurulacak -->
    </div>
  </div>

  <!-- Loading -->
  <div id="loading" class="hidden flex justify-center items-center py-12">
    <div
      class="animate-spin rounded-full h-12 w-12 border-b-2 border-slate-600"
    ></div>
  </div>
</div>

<script>
  let secilenOdaId = null;
  let odaBilgileri = null;
  let setuplar = [];
  let zimmetStoklar = {};

  // CSRF Token
  const csrfToken = "{{ csrf_token() }}";

  // Kat deƒüi≈ütiƒüinde
  document
    .getElementById("kat_id")
    .addEventListener("change", async function () {
      const katId = this.value;
      const odaSelect = document.getElementById("oda_id");

      odaSelect.innerHTML = '<option value="">Oda se√ßiniz...</option>';
      odaSelect.disabled = true;
      geriDon();

      if (!katId) return;

      try {
        const response = await fetch(`/kat-odalari?kat_id=${katId}`);
        const data = await response.json();

        if (data.success && data.odalar.length > 0) {
          data.odalar.forEach((oda) => {
            const option = document.createElement("option");
            option.value = oda.id;
            option.textContent = oda.oda_no;
            odaSelect.appendChild(option);
          });
          odaSelect.disabled = false;
        } else {
          odaSelect.innerHTML = '<option value="">Bu katta oda yok</option>';
        }
      } catch (error) {
        console.error("Hata:", error);
        toastGoster("Odalar y√ºklenirken hata olu≈ütu", "error");
      }
    });

  // Oda deƒüi≈ütiƒüinde
  document
    .getElementById("oda_id")
    .addEventListener("change", async function () {
      const odaId = this.value;

      if (!odaId) {
        geriDon();
        return;
      }

      secilenOdaId = odaId;
      await odaSetupDurumuYukle(odaId);
    });

  // Oda setup durumunu y√ºkle
  async function odaSetupDurumuYukle(odaId) {
    const loading = document.getElementById("loading");
    const odaSecimiSection = document.getElementById("oda_secimi_section");
    const odaDetaylariSection = document.getElementById(
      "oda_detaylari_section"
    );

    try {
      loading.classList.remove("hidden");

      const response = await fetch(`/api/kat-sorumlusu/oda-setup/${odaId}`);
      const data = await response.json();

      if (!response.ok || !data.success) {
        throw new Error(data.error || "Setup durumu y√ºklenemedi");
      }

      odaBilgileri = data.oda;
      setuplar = data.setuplar;
      zimmetStoklar = data.kat_sorumlusu_stok || {};

      console.log("Oda Bilgileri:", odaBilgileri);
      console.log("Setuplar:", setuplar);

      // UI g√ºncelle
      document.getElementById("oda_no_display").textContent =
        odaBilgileri.oda_no;
      document.getElementById("oda_tipi_display").textContent =
        odaBilgileri.oda_tipi;
      document.getElementById("toplam_setup_display").textContent =
        setuplar.length;

      // Accordion olu≈ütur
      setupAccordionOlustur();

      // Section'larƒ± deƒüi≈ütir
      odaSecimiSection.classList.add("hidden");
      odaDetaylariSection.classList.remove("hidden");
    } catch (error) {
      console.error("‚ùå Setup durumu y√ºkleme hatasƒ±:", error);
      toastGoster(error.message, "error");
    } finally {
      loading.classList.add("hidden");
    }
  }

  // Setup accordion olu≈ütur
  function setupAccordionOlustur() {
    const container = document.getElementById("setup_accordion_container");
    container.innerHTML = "";

    // Dolap i√ßi setuplarƒ± ayƒ±r
    const dolapIciSetuplar = setuplar.filter((s) => s.dolap_ici);
    const ilaveSetuplar = setuplar.filter((s) => !s.dolap_ici);

    console.log("Dolap ƒ∞√ßi Setuplar:", dolapIciSetuplar);
    console.log("ƒ∞lave Setuplar:", ilaveSetuplar);

    // Dolap i√ßi setuplarƒ± i≈üle
    dolapIciSetuplar.forEach((setup) => {
      const dolapSayisi = setup.dolap_sayisi || 0;
      console.log(`Setup: ${setup.setup_adi}, Dolap Sayƒ±sƒ±: ${dolapSayisi}`);

      if (dolapSayisi > 0) {
        // Her dolap i√ßin ayrƒ± accordion
        for (let dolapNo = 1; dolapNo <= dolapSayisi; dolapNo++) {
          const accordionHtml = createAccordionItem(
            `dolap_${setup.setup_id}_${dolapNo}`,
            `Dolap ${dolapNo} - ${setup.setup_adi}`,
            setup.urunler,
            "from-slate-600 to-slate-700"
          );
          container.insertAdjacentHTML("beforeend", accordionHtml);
        }
      }
    });

    // ƒ∞lave setuplarƒ± i≈üle
    ilaveSetuplar.forEach((setup) => {
      const accordionHtml = createAccordionItem(
        `ilave_${setup.setup_id}`,
        setup.setup_adi,
        setup.urunler,
        "from-slate-500 to-slate-600"
      );
      container.insertAdjacentHTML("beforeend", accordionHtml);
    });

    // Event listener'larƒ± ekle
    attachAccordionListeners();
  }

  // Accordion item olu≈ütur
  function createAccordionItem(id, baslik, urunler, gradientClass) {
    const toplamUrun = urunler.length;

    let urunlerHtml = "";
    urunler.forEach((urun) => {
      const zimmetMiktar = zimmetStoklar[urun.urun_id]
        ? zimmetStoklar[urun.urun_id].miktar
        : 0;

      urunlerHtml += `
            <tr class="hover:bg-slate-50 transition-colors">
                <td class="px-4 py-3 text-sm text-slate-900">${
                  urun.urun_adi
                }</td>
                <td class="px-4 py-3 text-sm text-center text-slate-600 font-medium">${
                  urun.setup_miktari
                }</td>
                <td class="px-4 py-3 text-sm text-center">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                      urun.ekstra_miktar > 0
                        ? "bg-blue-100 text-blue-800"
                        : "bg-slate-100 text-slate-600"
                    }">
                        ${urun.ekstra_miktar}
                    </span>
                </td>
                <td class="px-4 py-3 text-center space-x-2">
                    <button onclick="urunEkleModal(${urun.urun_id}, '${
        urun.urun_adi
      }', ${urun.setup_miktari}, '${urun.birim}', ${zimmetMiktar})"
                            class="inline-flex items-center px-3 py-1.5 bg-green-600 text-white text-xs font-medium rounded-lg hover:bg-green-700 transition-colors"
                            ${zimmetMiktar <= 0 ? "disabled" : ""}>
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        Ekle
                    </button>
                    <button onclick="ekstraEkleModal(${urun.urun_id}, '${
        urun.urun_adi
      }', '${urun.birim}', ${zimmetMiktar})"
                            class="inline-flex items-center px-3 py-1.5 bg-blue-600 text-white text-xs font-medium rounded-lg hover:bg-blue-700 transition-colors"
                            ${zimmetMiktar <= 0 ? "disabled" : ""}>
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        Ekstra
                    </button>
                    ${
                      urun.ekstra_miktar > 0
                        ? `
                        <button onclick="ekstraSifirlaModal(${urun.urun_id}, '${urun.urun_adi}', ${urun.ekstra_miktar}, '${urun.birim}')"
                                class="inline-flex items-center px-3 py-1.5 bg-orange-600 text-white text-xs font-medium rounded-lg hover:bg-orange-700 transition-colors">
                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                            0'la
                        </button>
                    `
                        : ""
                    }
                </td>
            </tr>
        `;
    });

    return `
        <div class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden">
            <button type="button" 
                    class="accordion-header w-full px-6 py-4 flex items-center justify-between bg-gradient-to-r ${gradientClass} text-white hover:opacity-90 transition-opacity"
                    data-target="${id}">
                <div class="flex items-center space-x-3">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                    </svg>
                    <span class="font-semibold text-lg">${baslik}</span>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="bg-white/20 backdrop-blur-sm px-3 py-1 rounded-full text-sm font-medium">
                        ${toplamUrun} √úr√ºn
                    </span>
                    <svg class="accordion-icon w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </div>
            </button>
            
            <div id="${id}" class="accordion-content hidden">
                <div class="p-6">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-slate-200">
                            <thead class="bg-slate-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase">√úr√ºn</th>
                                    <th class="px-4 py-3 text-center text-xs font-medium text-slate-500 uppercase">Setup Miktar</th>
                                    <th class="px-4 py-3 text-center text-xs font-medium text-slate-500 uppercase">Ekstra</th>
                                    <th class="px-4 py-3 text-center text-xs font-medium text-slate-500 uppercase">ƒ∞≈ülem</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-slate-200">
                                ${urunlerHtml}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    `;
  }

  // Accordion event listener'larƒ±
  function attachAccordionListeners() {
    document.querySelectorAll(".accordion-header").forEach((header) => {
      header.addEventListener("click", function () {
        const targetId = this.getAttribute("data-target");
        const content = document.getElementById(targetId);
        const icon = this.querySelector(".accordion-icon");

        // Toggle
        if (content.classList.contains("hidden")) {
          content.classList.remove("hidden");
          icon.style.transform = "rotate(180deg)";
        } else {
          content.classList.add("hidden");
          icon.style.transform = "rotate(0deg)";
        }
      });
    });
  }

  // Geri d√∂n
  function geriDon() {
    document.getElementById("oda_secimi_section").classList.remove("hidden");
    document.getElementById("oda_detaylari_section").classList.add("hidden");
    secilenOdaId = null;
    odaBilgileri = null;
    setuplar = [];
  }

  // Modal deƒüi≈ükenleri
  let aktifUrun = null;

  // T√ºketim modal a√ß
  function urunEkleModal(urunId, urunAdi, setupMiktar, birim, zimmetMiktar) {
    aktifUrun = { urunId, urunAdi, setupMiktar, birim, zimmetMiktar };

    document.getElementById("tuketim_urun_adi").textContent = urunAdi;
    document.getElementById(
      "tuketim_setup_miktar"
    ).textContent = `${setupMiktar} ${birim}`;
    document.getElementById(
      "tuketim_zimmet_miktar"
    ).textContent = `${zimmetMiktar} ${birim}`;
    document.getElementById("tuketim_max_miktar").textContent = setupMiktar;
    document.getElementById("tuketim_miktar_input").value = "";
    document.getElementById("tuketim_miktar_input").max = setupMiktar;

    $("#tuketim_modal").modal({
      fadeDuration: 200,
      fadeDelay: 0.1,
    });
  }

  async function tuketimKaydet() {
    const miktar = parseInt(
      document.getElementById("tuketim_miktar_input").value
    );

    if (!miktar || miktar <= 0) {
      toastGoster("L√ºtfen ge√ßerli bir miktar giriniz", "error");
      return;
    }

    if (miktar > aktifUrun.setupMiktar) {
      toastGoster(
        `Maksimum ${aktifUrun.setupMiktar} ${aktifUrun.birim} ekleyebilirsiniz`,
        "error"
      );
      return;
    }

    if (miktar > aktifUrun.zimmetMiktar) {
      toastGoster(
        `Stoƒüunuzda yeterli √ºr√ºn yok! Kalan: ${aktifUrun.zimmetMiktar} ${aktifUrun.birim}`,
        "error"
      );
      return;
    }

    try {
      const response = await fetch("/api/kat-sorumlusu/urun-tuketim-ekle", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": csrfToken,
        },
        body: JSON.stringify({
          oda_id: secilenOdaId,
          urun_id: aktifUrun.urunId,
          miktar: miktar,
        }),
      });

      const data = await response.json();

      if (!response.ok || !data.success) {
        throw new Error(data.error || "ƒ∞≈ülem ba≈üarƒ±sƒ±z");
      }

      toastGoster(data.message, "success");
      $.modal.close();
      aktifUrun = null;
      await odaSetupDurumuYukle(secilenOdaId);
    } catch (error) {
      console.error("‚ùå T√ºketim kaydetme hatasƒ±:", error);
      toastGoster(error.message, "error");
    }
  }

  // Ekstra modal a√ß
  function ekstraEkleModal(urunId, urunAdi, birim, zimmetMiktar) {
    aktifUrun = { urunId, urunAdi, birim, zimmetMiktar };

    document.getElementById("ekstra_urun_adi").textContent = urunAdi;
    document.getElementById(
      "ekstra_zimmet_miktar"
    ).textContent = `${zimmetMiktar} ${birim}`;
    document.getElementById("ekstra_miktar_input").value = "";

    $("#ekstra_modal").modal({
      fadeDuration: 200,
      fadeDelay: 0.1,
    });
  }

  async function ekstraKaydet() {
    const miktar = parseInt(
      document.getElementById("ekstra_miktar_input").value
    );

    if (!miktar || miktar <= 0) {
      toastGoster("L√ºtfen ge√ßerli bir miktar giriniz", "error");
      return;
    }

    if (miktar > aktifUrun.zimmetMiktar) {
      toastGoster(
        `Stoƒüunuzda yeterli √ºr√ºn yok! Kalan: ${aktifUrun.zimmetMiktar} ${aktifUrun.birim}`,
        "error"
      );
      return;
    }

    try {
      const response = await fetch("/api/kat-sorumlusu/urun-ekstra-ekle", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": csrfToken,
        },
        body: JSON.stringify({
          oda_id: secilenOdaId,
          urun_id: aktifUrun.urunId,
          miktar: miktar,
        }),
      });

      const data = await response.json();

      if (!response.ok || !data.success) {
        throw new Error(data.error || "ƒ∞≈ülem ba≈üarƒ±sƒ±z");
      }

      toastGoster(data.message, "success");
      $.modal.close();
      aktifUrun = null;
      await odaSetupDurumuYukle(secilenOdaId);
    } catch (error) {
      console.error("‚ùå Ekstra ekleme hatasƒ±:", error);
      toastGoster(error.message, "error");
    }
  }

  // Sƒ±fƒ±rla modal a√ß
  function ekstraSifirlaModal(urunId, urunAdi, ekstraMiktar, birim) {
    aktifUrun = { urunId, urunAdi, ekstraMiktar, birim };

    document.getElementById("sifirla_urun_adi").textContent = urunAdi;
    document.getElementById(
      "sifirla_ekstra_miktar"
    ).textContent = `${ekstraMiktar} ${birim}`;

    $("#sifirla_modal").modal({
      fadeDuration: 200,
      fadeDelay: 0.1,
    });
  }

  async function sifirlaKaydet() {
    try {
      const response = await fetch("/api/kat-sorumlusu/ekstra-sifirla", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": csrfToken,
        },
        body: JSON.stringify({
          oda_id: secilenOdaId,
          urun_id: aktifUrun.urunId,
          miktar: aktifUrun.ekstraMiktar,
        }),
      });

      const data = await response.json();

      if (!response.ok || !data.success) {
        throw new Error(data.error || "ƒ∞≈ülem ba≈üarƒ±sƒ±z");
      }

      toastGoster(data.message, "success");
      $.modal.close();
      aktifUrun = null;
      await odaSetupDurumuYukle(secilenOdaId);
    } catch (error) {
      console.error("‚ùå Ekstra sƒ±fƒ±rlama hatasƒ±:", error);
      toastGoster(error.message, "error");
    }
  }

  // QR ile ba≈ülat
  function qrIleBaslat() {
    window.location.href = "/kat-sorumlusu/qr-okuyucu?redirect=minibar-kontrol";
  }

  // Sayfa y√ºklendiƒüinde URL parametrelerini kontrol et
  window.addEventListener("DOMContentLoaded", async function () {
    const urlParams = new URLSearchParams(window.location.search);
    const katId = urlParams.get("kat_id");
    const odaId = urlParams.get("oda_id");

    // QR'dan geliyorsa otomatik y√ºkle
    if (katId && odaId) {
      try {
        console.log("üîç QR'dan gelen parametreler:", { katId, odaId });

        // Kat se√ßimini yap
        const katSelect = document.getElementById("kat_id");
        katSelect.value = katId;

        // Odalarƒ± y√ºkle
        const response = await fetch(`/kat-odalari?kat_id=${katId}`);
        const data = await response.json();

        if (data.success && data.odalar.length > 0) {
          const odaSelect = document.getElementById("oda_id");
          odaSelect.innerHTML = '<option value="">Oda se√ßiniz...</option>';

          data.odalar.forEach((oda) => {
            const option = document.createElement("option");
            option.value = oda.id;
            option.textContent = oda.oda_no;
            odaSelect.appendChild(option);
          });

          odaSelect.disabled = false;
          odaSelect.value = odaId;

          // Oda detaylarƒ±nƒ± y√ºkle
          secilenOdaId = odaId;
          await odaSetupDurumuYukle(odaId);

          toastGoster("‚úÖ QR kod ba≈üarƒ±yla okundu!", "success");

          // URL'den parametreleri temizle (temiz g√∂r√ºn√ºm i√ßin)
          window.history.replaceState(
            {},
            document.title,
            window.location.pathname
          );
        } else {
          throw new Error("Bu katta oda bulunamadƒ±");
        }
      } catch (error) {
        console.error("‚ùå QR parametreleri i≈ülenirken hata:", error);
        toastGoster("QR kod i≈ülenirken hata: " + error.message, "error");
      }
    }
  });

  // Toast mesajƒ±
  function toastGoster(mesaj, tip = "info") {
    const toast = document.createElement("div");
    toast.className = `fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg text-white transform transition-all duration-300 ${
      tip === "success"
        ? "bg-green-500"
        : tip === "error"
        ? "bg-red-500"
        : tip === "warning"
        ? "bg-orange-500"
        : "bg-blue-500"
    }`;
    toast.textContent = mesaj;

    document.body.appendChild(toast);

    setTimeout(() => {
      toast.style.opacity = "0";
      setTimeout(() => document.body.removeChild(toast), 300);
    }, 3000);
  }

  // Dialog backdrop tƒ±klamasƒ±nda kapanma
  document.addEventListener("DOMContentLoaded", function () {
    const dialogs = ["tuketim_modal", "ekstra_modal", "sifirla_modal"];

    dialogs.forEach((dialogId) => {
      const dialog = document.getElementById(dialogId);
      if (dialog) {
        dialog.addEventListener("click", function (e) {
          const rect = dialog.getBoundingClientRect();
          const isInDialog =
            rect.top <= e.clientY &&
            e.clientY <= rect.top + rect.height &&
            rect.left <= e.clientX &&
            e.clientX <= rect.left + rect.width;

          if (!isInDialog) {
            dialog.close();
            aktifUrun = null;
          }
        });
      }
    });
  });
</script>

<!-- T√ºketim Ekle Modal - jQuery Modal -->
<div id="tuketim_modal" class="modal p-2">
  <div
    class="bg-slate-900 dark:bg-slate-900 rounded-xl shadow-2xl max-w-sm w-full mx-auto overflow-hidden"
  >
    <!-- Header - Mini -->
    <div
      class="bg-gradient-to-r from-purple-600 to-indigo-600 px-3 py-2 flex items-center justify-between"
    >
      <h3 class="text-sm font-bold text-white">√úr√ºn Ekle</h3>
      <a
        href="#"
        rel="modal:close"
        class="w-6 h-6 flex items-center justify-center rounded bg-white/10 hover:bg-white/20 transition-colors"
      >
        <svg
          class="w-4 h-4 text-white"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          ></path>
        </svg>
      </a>
    </div>

    <!-- Content - Minimal & Hƒ±zlƒ± -->
    <div class="p-3 space-y-2">
      <!-- √úr√ºn Adƒ± - Kompakt -->
      <p
        id="tuketim_urun_adi"
        class="text-sm font-bold text-white text-center py-1"
      ></p>

      <!-- Bilgiler - Tek Satƒ±r -->
      <div class="flex justify-between text-xs text-slate-400 px-2">
        <span
          >Setup:
          <strong id="tuketim_setup_miktar" class="text-white">-</strong></span
        >
        <span>Eksik: <strong class="text-slate-300">0</strong></span>
        <span
          >Stok:
          <strong id="tuketim_zimmet_miktar" class="text-white">-</strong></span
        >
      </div>

      <!-- Input - B√ºy√ºk ve Kolay -->
      <input
        type="number"
        id="tuketim_miktar_input"
        min="1"
        inputmode="numeric"
        class="block w-full px-3 py-3 text-3xl font-bold text-center bg-slate-800 border-2 border-purple-500 rounded-lg focus:ring-2 focus:ring-purple-400 text-white placeholder-slate-500"
        placeholder="?"
      />
      <p class="text-xs text-slate-400 text-center">
        Max:
        <span id="tuketim_max_miktar" class="font-semibold text-white">-</span>
      </p>
    </div>

    <!-- Footer - B√ºy√ºk Butonlar -->
    <div class="bg-slate-800 px-3 py-2 border-t border-slate-700 flex gap-2">
      <a
        href="#"
        rel="modal:close"
        class="flex-1 px-4 py-4 bg-slate-700 text-white font-bold rounded-lg hover:bg-slate-600 active:scale-95 transition-all text-center text-lg"
      >
        ‚úï
      </a>
      <button
        onclick="tuketimKaydet()"
        type="button"
        class="flex-[3] px-4 py-4 bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-bold rounded-lg hover:from-purple-700 hover:to-indigo-700 active:scale-95 transition-all text-lg"
      >
        ‚úì KAYDET
      </button>
    </div>
  </div>
</div>

<!-- Ekstra Ekle Modal - jQuery Modal -->
<div id="ekstra_modal" class="modal p-2">
  <div
    class="bg-slate-900 dark:bg-slate-900 rounded-xl shadow-2xl max-w-sm w-full mx-auto overflow-hidden"
  >
    <!-- Header - Mini -->
    <div
      class="bg-gradient-to-r from-blue-600 to-cyan-600 px-3 py-2 flex items-center justify-between"
    >
      <h3 class="text-sm font-bold text-white">Ekstra Ekle</h3>
      <a
        href="#"
        rel="modal:close"
        class="w-6 h-6 flex items-center justify-center rounded bg-white/10 hover:bg-white/20 transition-colors"
      >
        <svg
          class="w-4 h-4 text-white"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          ></path>
        </svg>
      </a>
    </div>

    <!-- Content - Minimal -->
    <div class="p-3 space-y-2">
      <!-- √úr√ºn Adƒ± -->
      <p
        id="ekstra_urun_adi"
        class="text-sm font-bold text-white text-center py-1"
      ></p>

      <!-- Stok Bilgisi -->
      <div class="text-center text-xs text-slate-400">
        Stok:
        <strong id="ekstra_zimmet_miktar" class="text-white text-sm">-</strong>
      </div>

      <!-- Input - B√ºy√ºk -->
      <input
        type="number"
        id="ekstra_miktar_input"
        min="1"
        inputmode="numeric"
        class="block w-full px-3 py-3 text-3xl font-bold text-center bg-slate-800 border-2 border-blue-500 rounded-lg focus:ring-2 focus:ring-blue-400 text-white placeholder-slate-500"
        placeholder="?"
      />

      <!-- Bilgi - Kompakt -->
      <p class="text-xs text-blue-300 text-center">Setup dƒ±≈üƒ± ekstra</p>
    </div>

    <!-- Footer - B√ºy√ºk Butonlar -->
    <div class="bg-slate-800 px-3 py-2 border-t border-slate-700 flex gap-2">
      <a
        href="#"
        rel="modal:close"
        class="flex-1 px-4 py-4 bg-slate-700 text-white font-bold rounded-lg hover:bg-slate-600 active:scale-95 transition-all text-center text-lg"
      >
        ‚úï
      </a>
      <button
        onclick="ekstraKaydet()"
        type="button"
        class="flex-[3] px-4 py-4 bg-gradient-to-r from-blue-600 to-cyan-600 text-white font-bold rounded-lg hover:from-blue-700 hover:to-cyan-700 active:scale-95 transition-all text-lg"
      >
        ‚úì KAYDET
      </button>
    </div>
  </div>
</div>

<!-- Ekstra Sƒ±fƒ±rla Modal - jQuery Modal -->
<div id="sifirla_modal" class="modal p-4 sm:p-6 md:p-8">
  <div
    class="bg-slate-900 dark:bg-slate-900 rounded-2xl shadow-2xl max-w-sm w-full mx-auto overflow-hidden"
  >
    <!-- Header - Kompakt -->
    <div
      class="bg-gradient-to-r from-orange-600 to-red-600 px-4 py-3 flex items-center justify-center"
    >
      <div
        class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center"
      >
        <svg
          class="w-5 h-5 text-white"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
          ></path>
        </svg>
      </div>
    </div>

    <!-- Content - Ultra Kompakt -->
    <div class="p-4 space-y-3">
      <h3 class="text-base font-bold text-white text-center">
        Ekstra √úr√ºn√º Sƒ±fƒ±rla
      </h3>

      <!-- √úr√ºn Bilgileri -->
      <div
        class="bg-slate-800 rounded-lg p-3 border border-slate-700 space-y-2"
      >
        <div class="flex justify-between items-center">
          <span class="text-xs font-semibold text-slate-400">√úr√ºn:</span>
          <span
            id="sifirla_urun_adi"
            class="text-sm font-bold text-white"
          ></span>
        </div>
        <div class="flex justify-between items-center">
          <span class="text-xs font-semibold text-slate-400"
            >Ekstra Miktar:</span
          >
          <span
            id="sifirla_ekstra_miktar"
            class="text-lg font-bold text-orange-400"
          ></span>
        </div>
      </div>

      <!-- Uyarƒ± -->
      <div
        class="bg-orange-900/30 rounded-lg p-2.5 border-l-4 border-orange-600"
      >
        <p class="text-xs text-orange-300">
          <strong>‚ö†Ô∏è</strong> T√ºketim kaydedilecek. Stoƒüunuzdan d√º≈üme olmayacak.
        </p>
      </div>

      <p class="text-center text-xs font-semibold text-slate-300">
        Bu i≈ülemi onaylƒ±yor musunuz?
      </p>
    </div>

    <!-- Footer - Kompakt -->
    <div class="bg-slate-800 px-4 py-3 border-t border-slate-700 flex gap-2">
      <a
        href="#"
        rel="modal:close"
        class="flex-1 px-4 py-2.5 bg-slate-700 text-slate-300 font-semibold rounded-lg hover:bg-slate-600 active:scale-95 transition-all text-center"
      >
        ƒ∞ptal
      </a>
      <button
        onclick="sifirlaKaydet()"
        type="button"
        class="flex-1 px-4 py-2.5 bg-gradient-to-r from-orange-600 to-red-600 text-white font-bold rounded-lg hover:from-orange-700 hover:to-red-700 active:scale-95 transition-all"
      >
        Evet, Sƒ±fƒ±rla
      </button>
    </div>
  </div>
</div>

{% endblock %}
