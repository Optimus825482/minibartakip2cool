{% extends "base.html" %}

{% block title %}Personel Zimmetleri - Admin Panel{% endblock %}
{% block page_title %}Personel Zimmetleri{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Filtreler -->
    <div class="bg-white shadow rounded-lg p-6">
        <h3 class="text-lg font-semibold text-slate-900 mb-4">Filtreler</h3>
        <form method="GET" action="{{ url_for('admin_personel_zimmetleri') }}" class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
                <label class="block text-sm font-medium text-slate-700 mb-2">Personel</label>
                <select name="personel_id" class="w-full px-4 py-2 border border-slate-300 rounded-lg">
                    <option value="">Tümü</option>
                    {% for personel in personeller %}
                    <option value="{{ personel.id }}" {% if personel_id == personel.id %}selected{% endif %}>
                        {{ personel.ad }} {{ personel.soyad }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-slate-700 mb-2">Durum</label>
                <select name="durum" class="w-full px-4 py-2 border border-slate-300 rounded-lg">
                    <option value="">Tümü</option>
                    <option value="aktif" {% if durum == 'aktif' %}selected{% endif %}>Aktif</option>
                    <option value="tamamlandi" {% if durum == 'tamamlandi' %}selected{% endif %}>Tamamlandı</option>
                    <option value="iptal" {% if durum == 'iptal' %}selected{% endif %}>İptal</option>
                </select>
            </div>
            
            <div class="flex items-end space-x-4">
                <a href="{{ url_for('admin_personel_zimmetleri') }}"
                    class="px-6 py-2 border border-slate-300 rounded-lg text-slate-700 hover:bg-slate-50">
                    Temizle
                </a>
                <button type="submit"
                    class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    Filtrele
                </button>
            </div>
        </form>
    </div>
    
    <!-- Zimmet Listesi -->
    <div class="bg-white shadow rounded-lg overflow-hidden">
        <div class="px-6 py-4 border-b border-slate-200">
            <h3 class="text-lg font-semibold text-slate-900">
                Personel Zimmetleri ({{ zimmetler.total }} kayıt)
            </h3>
        </div>
        
        {% if zimmetler.items %}
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-slate-200">
                <thead class="bg-slate-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase">Zimmet No</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase">Personel</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase">Tarih</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase">Ürün Sayısı</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase">Durum</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase">Teslim Eden</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-slate-500 uppercase">İşlemler</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-slate-200">
                    {% for zimmet in zimmetler.items %}
                    <tr class="hover:bg-slate-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900">
                            #{{ zimmet.id }}
                        </td>
                        <td class="px-6 py-4 text-sm text-slate-900">
                            {{ zimmet.personel.ad }} {{ zimmet.personel.soyad }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-600">
                            {{ zimmet.zimmet_tarihi.strftime('%d.%m.%Y %H:%M') }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-900">
                            {{ zimmet.detaylar|length }} ürün
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 text-xs font-semibold rounded-full
                                {% if zimmet.durum == 'aktif' %}bg-green-100 text-green-800
                                {% elif zimmet.durum == 'tamamlandi' %}bg-blue-100 text-blue-800
                                {% else %}bg-red-100 text-red-800{% endif %}">
                                {{ zimmet.durum.title() }}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-sm text-slate-600">
                            {% if zimmet.teslim_eden %}
                            {{ zimmet.teslim_eden.ad }} {{ zimmet.teslim_eden.soyad }}
                            {% else %}
                            -
                            {% endif %}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            <a href="{{ url_for('admin_zimmet_detay', zimmet_id=zimmet.id) }}" 
                               class="text-blue-600 hover:text-blue-900">
                                Detay
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Sayfalama -->
        {% if zimmetler.pages > 1 %}
        <div class="px-6 py-4 border-t border-slate-200 flex justify-between items-center">
            <div class="text-sm text-slate-600">
                Sayfa {{ zimmetler.page }} / {{ zimmetler.pages }}
            </div>
            <div class="flex space-x-2">
                {% if zimmetler.has_prev %}
                <a href="{{ url_for('admin_personel_zimmetleri', sayfa=zimmetler.prev_num, personel_id=personel_id, durum=durum) }}"
                    class="px-4 py-2 border border-slate-300 rounded-lg text-slate-700 hover:bg-slate-50">
                    Önceki
                </a>
                {% endif %}
                {% if zimmetler.has_next %}
                <a href="{{ url_for('admin_personel_zimmetleri', sayfa=zimmetler.next_num, personel_id=personel_id, durum=durum) }}"
                    class="px-4 py-2 border border-slate-300 rounded-lg text-slate-700 hover:bg-slate-50">
                    Sonraki
                </a>
                {% endif %}
            </div>
        </div>
        {% endif %}
        {% else %}
        <div class="px-6 py-12 text-center text-slate-500">
            Zimmet kaydı bulunamadı.
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
