{% extends "base.html" %} {% block title %}Satın Alma Geçmişi - {{ urun.urun_adi
}}{% endblock %} {% block page_title %}Satın Alma Geçmişi{% endblock %} {% block
content %}
<div class="space-y-6">
  <!-- Başlık ve Geri Butonu -->
  <div
    class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"
  >
    <div>
      <h2 class="text-2xl font-bold text-slate-900 dark:text-white">
        {{ urun.urun_adi }}
      </h2>
      <p class="text-sm text-slate-600 dark:text-slate-400 mt-1">
        Satın Alma Geçmişi ve Fiyat Analizi
      </p>
    </div>
    <a
      href="{{ url_for('urun_tedarikci_fiyat') }}"
      class="inline-flex items-center px-4 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors"
    >
      <i class="fas fa-arrow-left mr-2"></i>Geri
    </a>
  </div>

  <!-- Ürün Bilgileri -->
  <div
    class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg shadow-lg p-6 text-white"
  >
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <p class="text-sm opacity-90">Ürün Grubu</p>
        <p class="text-lg font-semibold mt-1">
          {{ urun.urun_grubu.grup_adi if urun.urun_grubu else '-' }}
        </p>
      </div>
      <div>
        <p class="text-sm opacity-90">Satış Fiyatı</p>
        <p class="text-lg font-semibold mt-1">
          {{ "%.2f"|format(urun.satis_fiyati) if urun.satis_fiyati else '-' }} ₺
        </p>
      </div>
      <div>
        <p class="text-sm opacity-90">Mevcut Stok</p>
        <p class="text-lg font-semibold mt-1">{{ toplam_stok }} adet</p>
      </div>
    </div>
  </div>

  <!-- Satın Alma Geçmişi Tablosu -->
  <div
    class="bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700"
  >
    <div class="px-6 py-4 border-b border-slate-200 dark:border-slate-700">
      <h3 class="text-lg font-semibold text-slate-900 dark:text-white">
        <i class="fas fa-history mr-2 text-blue-600 dark:text-blue-400"></i>
        Satın Alma Geçmişi (Son 1 Yıl)
      </h3>
    </div>

    <div class="overflow-x-auto">
      <table class="w-full">
        <thead
          class="bg-slate-50 dark:bg-slate-700 border-b border-slate-200 dark:border-slate-600"
        >
          <tr>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-slate-700 dark:text-slate-300 uppercase"
            >
              Sipariş No
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-slate-700 dark:text-slate-300 uppercase"
            >
              Tarih
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-slate-700 dark:text-slate-300 uppercase"
            >
              Tedarikçi
            </th>
            <th
              class="px-6 py-3 text-right text-xs font-medium text-slate-700 dark:text-slate-300 uppercase"
            >
              Miktar
            </th>
            <th
              class="px-6 py-3 text-right text-xs font-medium text-slate-700 dark:text-slate-300 uppercase"
            >
              Birim Fiyat
            </th>
            <th
              class="px-6 py-3 text-right text-xs font-medium text-slate-700 dark:text-slate-300 uppercase"
            >
              Toplam
            </th>
            <th
              class="px-6 py-3 text-center text-xs font-medium text-slate-700 dark:text-slate-300 uppercase"
            >
              Durum
            </th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-200 dark:divide-slate-700">
          {% if satin_almalar %} {% for detay in satin_almalar %}
          <tr class="hover:bg-slate-50 dark:hover:bg-slate-700/50">
            <td
              class="px-6 py-4 text-sm font-medium text-blue-600 dark:text-blue-400"
            >
              <a
                href="{{ url_for('siparis_detay', siparis_id=detay.siparis.id) }}"
              >
                {{ detay.siparis.siparis_no }}
              </a>
            </td>
            <td class="px-6 py-4 text-sm text-slate-900 dark:text-white">
              {{ detay.siparis.siparis_tarihi.strftime('%d.%m.%Y') }}
            </td>
            <td class="px-6 py-4 text-sm text-slate-900 dark:text-white">
              {{ detay.siparis.tedarikci.tedarikci_adi }}
            </td>
            <td
              class="px-6 py-4 text-sm text-right text-slate-900 dark:text-white"
            >
              {{ detay.miktar }} adet
            </td>
            <td
              class="px-6 py-4 text-sm text-right font-medium text-slate-900 dark:text-white"
            >
              {{ "%.2f"|format(detay.birim_fiyat) }} ₺
            </td>
            <td
              class="px-6 py-4 text-sm text-right font-bold text-slate-900 dark:text-white"
            >
              {{ "%.2f"|format(detay.toplam_fiyat) }} ₺
            </td>
            <td class="px-6 py-4 text-center">
              {% if detay.siparis.durum.value == 'teslim_alindi' or
              detay.siparis.durum.value == 'tamamlandi' %}
              <span
                class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400"
              >
                Tamamlandı
              </span>
              {% elif detay.siparis.durum.value == 'onaylandi' %}
              <span
                class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400"
              >
                Onaylandı
              </span>
              {% elif detay.siparis.durum.value == 'beklemede' %}
              <span
                class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400"
              >
                Beklemede
              </span>
              {% else %}
              <span
                class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"
              >
                İptal
              </span>
              {% endif %}
            </td>
          </tr>
          {% endfor %} {% else %}
          <tr>
            <td colspan="7" class="px-6 py-12 text-center">
              <div class="flex flex-col items-center justify-center">
                <i
                  class="fas fa-inbox text-slate-300 dark:text-slate-600 text-5xl mb-4"
                ></i>
                <p
                  class="text-slate-500 dark:text-slate-400 text-lg font-medium"
                >
                  Satın Alma Kaydı Bulunamadı
                </p>
                <p class="text-slate-400 dark:text-slate-500 text-sm mt-2">
                  Bu ürün için henüz satın alma yapılmamış
                </p>
              </div>
            </td>
          </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
