{% extends "base.html" %}

{% block title %}Sipariş Yönetimi - Minibar Takip Sistemi{% endblock %}
{% block page_title %}Sipariş Yönetimi{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- İstatistikler -->
    <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
        <div class="bg-white dark:bg-slate-800 rounded-lg shadow p-4 border-l-4 border-blue-500">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-slate-600 dark:text-slate-400">Toplam</p>
                    <p class="text-2xl font-bold text-slate-900 dark:text-white">{{ istatistikler.toplam }}</p>
                </div>
                <i class="fas fa-shopping-cart text-3xl text-blue-500"></i>
            </div>
        </div>

        <div class="bg-white dark:bg-slate-800 rounded-lg shadow p-4 border-l-4 border-yellow-500">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-slate-600 dark:text-slate-400">Beklemede</p>
                    <p class="text-2xl font-bold text-slate-900 dark:text-white">{{ istatistikler.beklemede }}</p>
                </div>
                <i class="fas fa-hourglass-half text-3xl text-yellow-500"></i>
            </div>
        </div>

        <div class="bg-white dark:bg-slate-800 rounded-lg shadow p-4 border-l-4 border-green-500">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-slate-600 dark:text-slate-400">Onaylandı</p>
                    <p class="text-2xl font-bold text-slate-900 dark:text-white">{{ istatistikler.onaylandi }}</p>
                </div>
                <i class="fas fa-check-circle text-3xl text-green-500"></i>
            </div>
        </div>

        <div class="bg-white dark:bg-slate-800 rounded-lg shadow p-4 border-l-4 border-blue-600">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-slate-600 dark:text-slate-400">Teslim Alındı</p>
                    <p class="text-2xl font-bold text-slate-900 dark:text-white">{{ istatistikler.teslim_alindi }}</p>
                </div>
                <i class="fas fa-box text-3xl text-blue-600"></i>
            </div>
        </div>

        <div class="bg-white dark:bg-slate-800 rounded-lg shadow p-4 border-l-4 border-red-500">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-slate-600 dark:text-slate-400">İptal</p>
                    <p class="text-2xl font-bold text-slate-900 dark:text-white">{{ istatistikler.iptal }}</p>
                </div>
                <i class="fas fa-times-circle text-3xl text-red-500"></i>
            </div>
        </div>
    </div>

    <!-- Filtreler ve Sipariş Listesi -->
    <div class="bg-white dark:bg-slate-800 rounded-lg shadow-lg border border-slate-200 dark:border-slate-700">
        <div class="p-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                <h3 class="text-lg font-semibold text-slate-900 dark:text-white">
                    <i class="fas fa-list mr-2"></i>Sipariş Listesi
                </h3>

                <!-- Filtreler -->
                <div class="flex flex-wrap gap-2">
                    <select onchange="window.location.href='{{ url_for('yonetici_siparis_listesi') }}?durum=' + this.value + '{% if otel_filtre %}&amp;otel_id={{ otel_filtre }}{% endif %}';"
                            class="px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white text-sm">
                        <option value="">Tüm Durumlar</option>
                        <option value="beklemede" {% if durum_filtre == 'beklemede' %}selected{% endif %}>Beklemede</option>
                        <option value="onaylandi" {% if durum_filtre == 'onaylandi' %}selected{% endif %}>Onaylandı</option>
                        <option value="teslim_alindi" {% if durum_filtre == 'teslim_alindi' %}selected{% endif %}>Teslim Alındı</option>
                        <option value="iptal" {% if durum_filtre == 'iptal' %}selected{% endif %}>İptal</option>
                    </select>

                    {% if oteller %}
                    <select onchange="window.location.href='{{ url_for('yonetici_siparis_listesi') }}?otel_id=' + this.value + '{% if durum_filtre %}&amp;durum={{ durum_filtre }}{% endif %}';"
                            class="px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white text-sm">
                        <option value="">Tüm Oteller</option>
                        {% for otel in oteller %}
                        <option value="{{ otel.id }}" {% if otel_filtre == otel.id %}selected{% endif %}>{{ otel.ad }}</option>
                        {% endfor %}
                    </select>
                    {% endif %}
                </div>
            </div>

            <!-- Sipariş Tablosu -->
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-slate-200 dark:divide-slate-700">
                    <thead class="bg-slate-50 dark:bg-slate-900">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider">
                                Sipariş No
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider">
                                Otel
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider">
                                Tedarikçi
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider">
                                Tarih
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider">
                                Tutar
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider">
                                Durum
                            </th>
                            <th class="px-4 py-3 text-right text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider">
                                İşlemler
                            </th>
                        </tr>
                    </thead>
                    <tbody class="bg-white dark:bg-slate-800 divide-y divide-slate-200 dark:divide-slate-700">
                        {% for siparis in siparisler %}
                        <tr class="hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors">
                            <td class="px-4 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-slate-900 dark:text-white">
                                    {{ siparis.siparis_no }}
                                </div>
                                <div class="text-xs text-slate-500 dark:text-slate-400">
                                    {{ siparis.olusturan.ad }} {{ siparis.olusturan.soyad }}
                                </div>
                            </td>
                            <td class="px-4 py-4 whitespace-nowrap">
                                <div class="text-sm text-slate-900 dark:text-white">
                                    {{ siparis.otel.ad }}
                                </div>
                            </td>
                            <td class="px-4 py-4 whitespace-nowrap">
                                <div class="text-sm text-slate-900 dark:text-white">
                                    {% if siparis.tedarikci %}
                                        {{ siparis.tedarikci.tedarikci_adi }}
                                    {% else %}
                                        <span class="text-slate-400">Belirtilmemiş</span>
                                    {% endif %}
                                </div>
                            </td>
                            <td class="px-4 py-4 whitespace-nowrap">
                                <div class="text-sm text-slate-900 dark:text-white">
                                    {{ siparis.siparis_tarihi.strftime('%d.%m.%Y') }}
                                </div>
                            </td>
                            <td class="px-4 py-4 whitespace-nowrap">
                                <div class="text-sm font-semibold text-slate-900 dark:text-white">
                                    {{ "%.2f"|format(siparis.toplam_tutar) }} ₺
                                </div>
                            </td>
                            <td class="px-4 py-4 whitespace-nowrap">
                                {% if siparis.durum == 'beklemede' %}
                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200">
                                    <i class="fas fa-hourglass-half mr-1"></i>Beklemede
                                </span>
                                {% elif siparis.durum == 'onaylandi' %}
                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200">
                                    <i class="fas fa-check-circle mr-1"></i>Onaylandı
                                </span>
                                {% elif siparis.durum == 'teslim_alindi' %}
                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200">
                                    <i class="fas fa-box mr-1"></i>Teslim Alındı
                                </span>
                                {% elif siparis.durum == 'iptal' %}
                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200">
                                    <i class="fas fa-times-circle mr-1"></i>İptal
                                </span>
                                {% endif %}
                            </td>
                            <td class="px-4 py-4 whitespace-nowrap text-right text-sm font-medium">
                                <div class="flex items-center justify-end gap-2">
                                    <a href="{{ url_for('yonetici_siparis_detay', siparis_id=siparis.id) }}"
                                       class="text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300"
                                       title="Detay">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    
                                    {% if siparis.durum == 'beklemede' %}
                                    <form method="POST" action="{{ url_for('yonetici_siparis_onayla', siparis_id=siparis.id) }}" class="inline">
                                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                                        <button type="submit"
                                                class="text-green-600 hover:text-green-900 dark:text-green-400 dark:hover:text-green-300"
                                                title="Onayla"
                                                onclick="return confirm('Bu siparişi onaylamak istediğinizden emin misiniz?')">
                                            <i class="fas fa-check"></i>
                                        </button>
                                    </form>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="7" class="px-4 py-8 text-center text-slate-500 dark:text-slate-400">
                                <i class="fas fa-inbox text-4xl mb-2"></i>
                                <p>Sipariş bulunamadı</p>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}
