<!-- Admin & Sistem Yöneticisi Sidebar - Modüler Profesyonel Yapı -->

<!-- Dashboard - Ana Sayfa -->
<a
  href="{{ url_for('sistem_yoneticisi_dashboard') }}"
  class="sidebar-item mb-4 {% if request.endpoint == 'sistem_yoneticisi_dashboard' %}active{% endif %}"
>
  <svg
    class="sidebar-icon"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
    ></path>
  </svg>
  <span class="sidebar-text font-semibold">Dashboard</span>
</a>

<!-- Otel & Yapı Yönetimi -->
<div class="sidebar-section" data-section="otel">
  <button class="sidebar-section-header" onclick="toggleSection('otel')">
    <div class="flex items-center">
      <i class="fas fa-hotel text-xs mr-2"></i>
      <span>Otel & Yapı</span>
    </div>
    <i class="fas fa-chevron-down section-arrow"></i>
  </button>
  <div class="sidebar-section-content" id="section-otel">
    <a
      href="{{ url_for('otel_listesi') }}"
      class="sidebar-item {% if request.endpoint == 'otel_listesi' %}active{% endif %}"
    >
      <i class="fas fa-hotel sidebar-icon"></i>
      <span class="sidebar-text">Oteller</span>
    </a>
    <a
      href="{{ url_for('kat_tanimla') }}"
      class="sidebar-item {% if request.endpoint == 'kat_tanimla' %}active{% endif %}"
    >
      <i class="fas fa-layer-group sidebar-icon"></i>
      <span class="sidebar-text">Katlar</span>
    </a>
    <a
      href="{{ url_for('oda_tanimla') }}"
      class="sidebar-item {% if request.endpoint == 'oda_tanimla' %}active{% endif %}"
    >
      <i class="fas fa-door-open sidebar-icon"></i>
      <span class="sidebar-text">Odalar</span>
    </a>
    <a
      href="{{ url_for('setup_yonetimi') }}"
      class="sidebar-item {% if request.endpoint == 'setup_yonetimi' %}active{% endif %}"
    >
      <i class="fas fa-cog sidebar-icon"></i>
      <span class="sidebar-text">Setup'lar</span>
    </a>
    <a
      href="{{ url_for('personel_tanimla') }}"
      class="sidebar-item {% if request.endpoint == 'personel_tanimla' %}active{% endif %}"
    >
      <i class="fas fa-user-tie sidebar-icon"></i>
      <span class="sidebar-text">Kullanıcılar</span>
    </a>
  </div>
</div>

<!-- Ürün & Stok Yönetimi -->
<div class="sidebar-section" data-section="stok">
  <button class="sidebar-section-header" onclick="toggleSection('stok')">
    <div class="flex items-center">
      <i class="fas fa-boxes text-xs mr-2"></i>
      <span>Ürün & Stok</span>
    </div>
    <i class="fas fa-chevron-down section-arrow"></i>
  </button>
  <div class="sidebar-section-content" id="section-stok">
    <a
      href="{{ url_for('urun_gruplari') }}"
      class="sidebar-item {% if request.endpoint == 'urun_gruplari' %}active{% endif %}"
    >
      <i class="fas fa-tags sidebar-icon"></i>
      <span class="sidebar-text">Ürün Grupları</span>
    </a>
    <a
      href="{{ url_for('urunler') }}"
      class="sidebar-item {% if request.endpoint == 'urunler' %}active{% endif %}"
    >
      <i class="fas fa-box sidebar-icon"></i>
      <span class="sidebar-text">Ürünler</span>
    </a>
    <a
      href="{{ url_for('admin_depo_stoklari') }}"
      class="sidebar-item {% if request.endpoint == 'admin_depo_stoklari' %}active{% endif %}"
    >
      <i class="fas fa-warehouse sidebar-icon"></i>
      <span class="sidebar-text">Depo Stokları</span>
    </a>
    <a
      href="{{ url_for('otel_ilk_stok_yukleme') }}"
      class="sidebar-item {% if request.endpoint == 'otel_ilk_stok_yukleme' %}active{% endif %}"
    >
      <i class="fas fa-cloud-upload-alt sidebar-icon text-emerald-500"></i>
      <span class="sidebar-text">İlk Stok Yükleme (FIFO)</span>
    </a>
    <a
      href="{{ url_for('admin_stok_hareketleri') }}"
      class="sidebar-item {% if request.endpoint == 'admin_stok_hareketleri' %}active{% endif %}"
    >
      <i class="fas fa-exchange-alt sidebar-icon"></i>
      <span class="sidebar-text">Stok Hareketleri</span>
    </a>
    <a
      href="{{ url_for('admin_personel_zimmetleri') }}"
      class="sidebar-item {% if request.endpoint == 'admin_personel_zimmetleri' %}active{% endif %}"
    >
      <i class="fas fa-clipboard-check sidebar-icon"></i>
      <span class="sidebar-text">Zimmetler</span>
    </a>
    <a
      href="{{ url_for('admin_ana_depo_tedarik_gecmisi') }}"
      class="sidebar-item {% if request.endpoint == 'admin_ana_depo_tedarik_gecmisi' %}active{% endif %}"
    >
      <i class="fas fa-truck-loading sidebar-icon text-blue-500"></i>
      <span class="sidebar-text">Ana Depo Tedarik Geçmişi</span>
    </a>
  </div>
</div>

<!-- Minibar Operasyonları -->
<div class="sidebar-section" data-section="minibar">
  <button class="sidebar-section-header" onclick="toggleSection('minibar')">
    <div class="flex items-center">
      <i class="fas fa-wine-bottle text-xs mr-2"></i>
      <span>Minibar</span>
    </div>
    <i class="fas fa-chevron-down section-arrow"></i>
  </button>
  <div class="sidebar-section-content" id="section-minibar">
    <a
      href="{{ url_for('admin_minibar_islemleri') }}"
      class="sidebar-item {% if request.endpoint == 'admin_minibar_islemleri' %}active{% endif %}"
    >
      <i class="fas fa-clipboard-list sidebar-icon"></i>
      <span class="sidebar-text">Minibar İşlemleri</span>
    </a>
    <a
      href="{{ url_for('dolum_talepleri') }}"
      class="sidebar-item {% if request.endpoint == 'dolum_talepleri' %}active{% endif %}"
    >
      <i class="fas fa-bell sidebar-icon"></i>
      <span class="sidebar-text">Dolum Talepleri</span>
      <span class="sidebar-badge" id="dolum-badge"></span>
    </a>
  </div>
</div>

<!-- ML & Yapay Zeka -->
<div class="sidebar-section" data-section="ml">
  <button class="sidebar-section-header" onclick="toggleSection('ml')">
    <div class="flex items-center">
      <i class="fas fa-brain text-xs mr-2"></i>
      <span>AI & Analitik</span>
    </div>
    <i class="fas fa-chevron-down section-arrow"></i>
  </button>
  <div class="sidebar-section-content" id="section-ml">
    <a
      href="{{ url_for('ml.dashboard') }}"
      class="sidebar-item {% if request.endpoint == 'ml.dashboard' %}active{% endif %}"
    >
      <i class="fas fa-robot sidebar-icon"></i>
      <span class="sidebar-text">ML Analiz Sistemi</span>
    </a>
  </div>
</div>

<!-- Raporlar & Analiz -->
<div class="sidebar-section" data-section="raporlar">
  <button class="sidebar-section-header" onclick="toggleSection('raporlar')">
    <div class="flex items-center">
      <i class="fas fa-chart-bar text-xs mr-2"></i>
      <span>Raporlar</span>
    </div>
    <i class="fas fa-chevron-down section-arrow"></i>
  </button>
  <div class="sidebar-section-content" id="section-raporlar">
    <a
      href="{{ url_for('raporlar.doluluk_raporlari') }}"
      class="sidebar-item {% if request.endpoint == 'raporlar.doluluk_raporlari' %}active{% endif %}"
    >
      <i class="fas fa-calendar-alt sidebar-icon"></i>
      <span class="sidebar-text">Doluluk Raporları</span>
    </a>
    <a
      href="{{ url_for('raporlar.stok_raporlari') }}"
      class="sidebar-item {% if request.endpoint == 'raporlar.stok_raporlari' %}active{% endif %}"
    >
      <i class="fas fa-boxes sidebar-icon"></i>
      <span class="sidebar-text">Stok Raporları</span>
    </a>

    <a
      href="{{ url_for('raporlar.zimmet_raporlari') }}"
      class="sidebar-item {% if request.endpoint == 'raporlar.zimmet_raporlari' %}active{% endif %}"
    >
      <i class="fas fa-user-tag sidebar-icon"></i>
      <span class="sidebar-text">Zimmet Raporları</span>
    </a>
    <a
      href="{{ url_for('raporlar.performans_raporlari') }}"
      class="sidebar-item {% if request.endpoint == 'raporlar.performans_raporlari' %}active{% endif %}"
    >
      <i class="fas fa-chart-line sidebar-icon"></i>
      <span class="sidebar-text">Performans Raporları</span>
    </a>
    <a
      href="{{ url_for('raporlar.otel_zimmet_stok_raporlari') }}"
      class="sidebar-item {% if request.endpoint == 'raporlar.otel_zimmet_stok_raporlari' %}active{% endif %}"
    >
      <i class="fas fa-hotel sidebar-icon text-blue-500"></i>
      <span class="sidebar-text">Otel Zimmet Stokları</span>
    </a>
    <a
      href="{{ url_for('raporlar.kat_sorumlusu_kullanim_raporlari') }}"
      class="sidebar-item {% if request.endpoint == 'raporlar.kat_sorumlusu_kullanim_raporlari' %}active{% endif %}"
    >
      <i class="fas fa-user-check sidebar-icon text-indigo-500"></i>
      <span class="sidebar-text">Kat Sorumlusu Kullanım</span>
    </a>
    <a
      href="{{ url_for('raporlar.oda_bazli_tuketim_raporlari') }}"
      class="sidebar-item {% if request.endpoint == 'raporlar.oda_bazli_tuketim_raporlari' %}active{% endif %}"
    >
      <i class="fas fa-door-open sidebar-icon text-teal-500"></i>
      <span class="sidebar-text">Oda Bazlı Tüketim</span>
    </a>
    <a
      href="{{ url_for('raporlar.gunluk_gorev_detay_raporlari') }}"
      class="sidebar-item {% if request.endpoint == 'raporlar.gunluk_gorev_detay_raporlari' %}active{% endif %}"
    >
      <i class="fas fa-tasks sidebar-icon text-amber-500"></i>
      <span class="sidebar-text">Günlük Görev Detay</span>
    </a>
    <a
      href="{{ url_for('raporlar.otel_karsilastirma_raporlari') }}"
      class="sidebar-item {% if request.endpoint == 'raporlar.otel_karsilastirma_raporlari' %}active{% endif %}"
    >
      <i class="fas fa-balance-scale sidebar-icon text-purple-500"></i>
      <span class="sidebar-text">Otel Karşılaştırma</span>
    </a>
  </div>
</div>

<!-- Sistem & Güvenlik -->
<div class="sidebar-section" data-section="sistem">
  <button class="sidebar-section-header" onclick="toggleSection('sistem')">
    <div class="flex items-center">
      <i class="fas fa-shield-alt text-xs mr-2"></i>
      <span>Sistem</span>
    </div>
    <i class="fas fa-chevron-down section-arrow"></i>
  </button>
  <div class="sidebar-section-content" id="section-sistem">
    <a
      href="{{ url_for('sistem_ayarlari') }}"
      class="sidebar-item {% if request.endpoint in ['sistem_ayarlari', 'sistem_ayarlari_email'] %}active{% endif %}"
    >
      <i class="fas fa-cogs sidebar-icon text-purple-500"></i>
      <span class="sidebar-text font-medium">Sistem Ayarları</span>
    </a>
    <a
      href="{{ url_for('email_loglari') }}"
      class="sidebar-item {% if request.endpoint == 'email_loglari' %}active{% endif %}"
    >
      <i class="fas fa-envelope sidebar-icon text-blue-500"></i>
      <span class="sidebar-text">Email Logları</span>
    </a>
    <a
      href="{{ url_for('audit_trail') }}"
      class="sidebar-item {% if request.endpoint == 'audit_trail' %}active{% endif %}"
    >
      <i class="fas fa-shield-alt sidebar-icon"></i>
      <span class="sidebar-text">Audit Trail</span>
    </a>
    <a
      href="{{ url_for('sistem_loglari') }}"
      class="sidebar-item {% if request.endpoint == 'sistem_loglari' %}active{% endif %}"
    >
      <i class="fas fa-file-alt sidebar-icon"></i>
      <span class="sidebar-text">Sistem Logları</span>
    </a>
  </div>
</div>

<!-- Yardım & Rehber -->
<div
  class="sidebar-section mt-4 pt-4 border-t border-slate-200 dark:border-slate-700"
>
  <button
    onclick="openSystemGuide()"
    class="sidebar-item w-full bg-gradient-to-r from-indigo-500/10 to-purple-500/10 hover:from-indigo-500/20 hover:to-purple-500/20 border border-indigo-200 dark:border-indigo-800"
  >
    <i class="fas fa-book-open sidebar-icon text-indigo-500"></i>
    <span class="sidebar-text font-medium text-indigo-700 dark:text-indigo-300"
      >Sistem Rehberi</span
    >
    <i class="fas fa-external-link-alt text-xs text-indigo-400 ml-auto"></i>
  </button>
</div>

<!-- Sidebar Styles -->
<style>
  /* Sidebar Item Base */
  .sidebar-item {
    display: flex;
    align-items: center;
    padding: 0.75rem 1rem;
    color: #475569;
    border-radius: 0.5rem;
    transition: all 0.2s ease;
    text-decoration: none;
    position: relative;
  }

  .dark .sidebar-item {
    color: #cbd5e1;
  }

  .sidebar-item:hover {
    background-color: #f1f5f9;
    color: #1e293b;
  }

  .dark .sidebar-item:hover {
    background-color: #334155;
    color: #f1f5f9;
  }

  /* Active State */
  .sidebar-item.active {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    color: white;
    font-weight: 500;
    box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.3);
  }

  .sidebar-item.active .sidebar-icon {
    color: white !important;
  }

  /* Sidebar Icon */
  .sidebar-icon {
    width: 1.25rem;
    height: 1.25rem;
    margin-right: 0.75rem;
    color: #64748b;
    flex-shrink: 0;
  }

  .dark .sidebar-icon {
    color: #94a3b8;
  }

  .sidebar-item:hover .sidebar-icon {
    color: #1e293b;
  }

  .dark .sidebar-item:hover .sidebar-icon {
    color: #f1f5f9;
  }

  /* Sidebar Text */
  .sidebar-text {
    font-size: 0.875rem;
    flex: 1;
  }

  /* Sidebar Badge */
  .sidebar-badge {
    display: none;
    background-color: #ef4444;
    color: white;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 0.125rem 0.5rem;
    border-radius: 9999px;
    margin-left: auto;
  }

  .sidebar-badge:not(:empty) {
    display: inline-block;
  }

  /* Sidebar Section */
  .sidebar-section {
    margin-top: 0.5rem;
  }

  /* Section Header */
  .sidebar-section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: 0.5rem 1rem;
    color: #64748b;
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    background: none;
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .dark .sidebar-section-header {
    color: #94a3b8;
  }

  .sidebar-section-header:hover {
    color: #1e293b;
  }

  .dark .sidebar-section-header:hover {
    color: #f1f5f9;
  }

  /* Section Arrow */
  .section-arrow {
    transition: transform 0.3s ease;
    font-size: 0.75rem;
  }

  .sidebar-section.collapsed .section-arrow {
    transform: rotate(-90deg);
  }

  /* Section Content */
  .sidebar-section-content {
    max-height: 1000px;
    overflow: hidden;
    transition: max-height 0.3s ease, opacity 0.3s ease;
    opacity: 1;
  }

  .sidebar-section.collapsed .sidebar-section-content {
    max-height: 0;
    opacity: 0;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .sidebar-text {
      font-size: 0.8125rem;
    }

    .sidebar-item {
      padding: 0.625rem 0.875rem;
    }
  }
</style>

<!-- Sidebar JavaScript -->
<script>
  // Toggle Section
  function toggleSection(sectionId) {
    const section = document.querySelector(`[data-section="${sectionId}"]`);
    if (section) {
      section.classList.toggle("collapsed");

      // LocalStorage'a kaydet
      const collapsed = section.classList.contains("collapsed");
      localStorage.setItem(
        `sidebar-${sectionId}`,
        collapsed ? "collapsed" : "expanded"
      );
    }
  }

  // Sayfa yüklendiğinde durumları geri yükle
  document.addEventListener("DOMContentLoaded", function () {
    // Tüm section'ları kontrol et
    document.querySelectorAll(".sidebar-section").forEach((section) => {
      const sectionId = section.getAttribute("data-section");
      const savedState = localStorage.getItem(`sidebar-${sectionId}`);

      if (savedState === "collapsed") {
        section.classList.add("collapsed");
      }
    });

    // Aktif section'ı aç
    const activeItem = document.querySelector(".sidebar-item.active");
    if (activeItem) {
      const parentSection = activeItem.closest(".sidebar-section");
      if (parentSection) {
        parentSection.classList.remove("collapsed");
      }
    }

    // Dolum talepleri badge'ini güncelle
    updateDolumBadge();
  });

  // Badge güncelleme fonksiyonu
  function updateDolumBadge() {
    try {
      fetch("/api/bekleyen-dolum-sayisi")
        .then((response) => {
          if (!response.ok) return { success: false, count: 0 };
          return response.json();
        })
        .then((data) => {
          if (data.success && data.count !== undefined) {
            const badge = document.getElementById("dolum-badge");
            if (badge) {
              badge.textContent = data.count > 0 ? data.count : "";
            }
          }
        })
        .catch(() => {
          // Sessizce hata yönet
        });
    } catch (error) {
      // Kritik hata - hiçbir şey yapma
    }
  }

  // Her 30 saniyede bir badge'leri güncelle
  setInterval(updateDolumBadge, 30000);
</script>
